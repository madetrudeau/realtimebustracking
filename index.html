<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="https://use.typekit.net/ypo7fdf.css"> -->

    <link rel="stylesheet" href="styles.css"

    <title>Madeleine's Project - Real-Time Bus Tracker</title>
    
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css' rel='stylesheet' />

  </head>
  <body class="body"> 
    <div class="container">
        <nav id="na" class="navbar fixed-top navbar-expand-sm navbar-dark" style="background-color: #F6CAB9">
            <a 
            href="https://madetrudeau.github.io/" 
            class="navbar-brand mb-0 h1">
                <img
                id="logo" 
                class="d-inline-block align-top"
                src="logo_plant.png"
                height="200"
                width="200">
            </a>
            <button 
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            class="navbar-toggler"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
            >
                <span class="navbar-toggler-icon"></span>
            </button>
            <div 
                class="collapse navbar-collapse" 
                id="navbarNav">
                <ul class="navbar nav">
                    <li class="nav-item" style="padding: 1.5em;">
                        <a href="https://madetrudeau.github.io/" class="nav-link"
                        aria-current="false"
                        style="color: #B8733A; font-size: 1em; font-family: shackleton, serif;">
                        Biography
                        </a>
                    </li>
                    <li class="nav-item dropdown" style="padding: 1.5em;">
                        <a class="nav-link 
                        dropdown-toggle"
                        style="color: #B8733A;  border-bottom: 3px solid #B8733A; font-size: 1em; font-family: shackleton, serif;"
                        id="navbarDropdown" 
                        role="button"
                        data-bs-toggle="dropdown"
                        aria-expanded="false">
                        Projects
                        </a>
                        <ul class="dropdown-menu"
                        aria-labelledby="navbarDropdown"
                        style="background-color: #F6CAB9;">
                            <li><a href="https://madetrudeau.github.io/pacmenexercise"
                                class="dropdown-item" 
                                style="background-color: #F6CAB9; color: #B8733A; font-family: shackleton, serif;">
                                Pacman</a></li>
                            <li><a href="https://madetrudeau.github.io/eyeexercise"
                                class="dropdown-item"
                                style="background-color: #F6CAB9; color: #B8733A; font-family: shackleton, serif;">
                                Eye Follower</a></li>    
                            <li><a href="https://madetrudeau.github.io/realtimebustracking"
                                class="dropdown-item active"
                                aria-current="true"
                                style="background-color: #F6CAB9; color: #B8733A; font-family: shackleton, serif;">
                                Real Time Bus Tracker</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
    <div id="map"></div>
    <script 
    const appID = "7CBB98B4AE7C7662E47CCD101";
    console.log(appID);
    let map = document.getElementById(map);

    mapboxgl.accessToken = 'pk.eyJ1IjoidGhhdHN0cnVkZWF1IiwiYSI6ImNsYjEyZnE2NDFwbGYzbm83d24weWdreXgifQ.zTvKoTNLxZjjp5opM3ei2Q';

    <!-- const map = new mapboxgl.Map({
        container: 'content', // container ID
        style: 'mapbox://styles/mapbox/streets-v12', // style URL
        center: [-74.5, 40], // starting position [lng, lat]
        zoom: 9, // starting zoom
    }); -->

    function createMapMarker() {

        let map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-71.091542, 42.358862],
        zoom: 12,
        });
    
        let marker = new mapboxgl.Marker().setLngLat([-71.091542, 42.358862]).addTo(map);
    }
    
    window.onload = () => {
        console.log("Window Loaded")
        createMapMarker();
    };


    async function run(){
        createMapMarker();
        const vehicleLocation = await getVehiclesCurrentLocation();
        //const stopInformation    = await getStopInfo('./gtfs/stops.txt');
        console.log(new Date());
        console.log("Latitude: " + vehicleLocation.vehicle[0].latitude);
        console.log("Longitude: " + vehicleLocation.vehicle[0].longitude);
        //console.log(stopInformation);
        //console.log(resultSet)

        //Timer
        setTimeout(run, 15000);
    }

    async function getVehiclesCurrentLocation(){
        const url = 'https://developer.trimet.org/ws/v2/vehicles&appID=' + appID;
        const response = await fetch(url);
        const json     = await response.json();
        return json.resultSet;
    }

    /* async function getStopInfo(filename){
        try{
            const contents = await fs.readFile(filename, 'utf8');
            const contentSplit = contents.split(/\r\n/);
            const titleSplit = contentSplit[0].split(',');
            let stopData = {};
            for(let i=0;i<titleSplit.length;i++){
                let tempArray = new Array;
                let interpArray = new Array;
                for(let j=1;j<contentSplit.length;j++){
                    tempArray = contentSplit[j].split(',');
                    if(isNaN(tempArray[i])){
                        interpArray.push(tempArray[i]);
                    }else{
                        interpArray.push(Number(tempArray[i]));
                    }
                }
                stopData[titleSplit[i]] = interpArray;
            }    
            return stopData;
        }
        catch(err){
            console.log(err);
        }
    } */


    window.onload = () => {
        createMapMarker();
    };
    run();
    </script>
    <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" 
    crossorigin="anonymous">
   </script>   
  </body>

